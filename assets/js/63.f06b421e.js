(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{330:function(t,s,a){"use strict";a.r(s);var e=a(14),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"deploy"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#deploy"}},[t._v("#")]),t._v(" Deploy")]),t._v(" "),s("h2",{attrs:{id:"host-for-free-on-fly-io"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#host-for-free-on-fly-io"}},[t._v("#")]),t._v(" Host for free on Fly.io")]),t._v(" "),s("h3",{attrs:{id:"_1-create-the-pocketbase-dockerfile"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-create-the-pocketbase-dockerfile"}},[t._v("#")]),t._v(" 1. Create the PocketBase Dockerfile:")]),t._v(" "),s("div",{staticClass:"language-dockerfile extra-class"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" alpine:latest")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ARG")]),t._v(" PB_VERSION=0.15.2")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" apk add --no-cache "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n    unzip "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# this is needed only if you want to use scp to copy later your pb_data locally")]),t._v("\n    openssh")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# download and unzip PocketBase")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ADD")]),t._v(" https://github.com/pocketbase/pocketbase/releases/download/v"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${PB_VERSION}")]),t._v("/pocketbase_"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${PB_VERSION}")]),t._v("_linux_amd64.zip /tmp/pb.zip")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" unzip /tmp/pb.zip -d /pb/")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("EXPOSE")]),t._v(" 8080")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# start PocketBase")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CMD")]),t._v(" ["),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/pb/pocketbase"')]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"serve"')]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--http=0.0.0.0:8080"')]),t._v("]")]),t._v("\n")])])]),s("h3",{attrs:{id:"_2-install-flyctl"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-install-flyctl"}},[t._v("#")]),t._v(" 2. Install Flyctl")]),t._v(" "),s("p",[t._v("Follow the installation instructions from "),s("a",{attrs:{href:"https://fly.io/docs/hands-on/install-flyctl/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://fly.io/docs/hands-on/install-flyctl/"),s("OutboundLink")],1),t._v(".")]),t._v(" "),s("p",[t._v("Run "),s("code",[t._v("flyctl auth")]),t._v(" signup to create a Fly.io account (email or GitHub).")]),t._v(" "),s("p",[t._v("Run "),s("code",[t._v("flyctl auth login")]),t._v(" to login.")]),t._v(" "),s("h3",{attrs:{id:"_3-launch-aka-machine-setup"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-launch-aka-machine-setup"}},[t._v("#")]),t._v(" 3. Launch (aka. machine setup)")]),t._v(" "),s("p",[t._v("Navigate to the directory where the Dockerfile from 1) was created.")]),t._v(" "),s("p",[t._v("Run "),s("code",[t._v("flyctl launch")]),t._v(" (optionally you can specify "),s("code",[t._v("--dockerfile")]),t._v(" if you are running from different directory).")]),t._v(" "),s("p",[t._v("This will prompt you a couple questions like the name of your app, deployment region, etc.")]),t._v(" "),s("p",[t._v("Type "),s("code",[t._v("n")]),t._v(" for the last 2 questions asking for creating a Postgresql database and whether you want to deploy directly.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("? Would you like to set up a Postgresql database now? No\n? Would you like to deploy now? No\n")])])]),s("p",[t._v("The launch command will create a "),s("code",[t._v("fly.toml")]),t._v(" configuration file in the working directory.")]),t._v(" "),s("h3",{attrs:{id:"_4-create-and-mount-1gb-free-persistent-volume"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-create-and-mount-1gb-free-persistent-volume"}},[t._v("#")]),t._v(" 4. Create and mount 1GB free persistent volume")]),t._v(" "),s("p",[t._v("Run "),s("code",[t._v("flyctl volumes create pb_data --size=1")])]),t._v(" "),s("p",[t._v("It will prompt you to select a region - preferably choose the same region as in 3).")]),t._v(" "),s("p",[t._v("Once finished, open "),s("code",[t._v("fly.toml")]),t._v(" and add somewhere at the root level the following "),s("code",[t._v("mounts")]),t._v(" config:")]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token table class-name"}},[t._v("mounts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("destination")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/pb/pb_data"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("source")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pb_data"')]),t._v("\n")])])]),s("p",[t._v("Your final "),s("code",[t._v("fly.toml")]),t._v(" should look something like this:")]),t._v(" "),s("div",{staticClass:"language-toml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-toml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# fly.toml file generated for pocketbase-test on 2022-09-18T12:44:18+03:00")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("app")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pocketbase-test"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("kill_signal")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SIGINT"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("kill_timeout")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("processes")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token table class-name"}},[t._v("experimental")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("allowed_public_ports")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("auto_rollback")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token table class-name"}},[t._v("mounts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("destination")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/pb/pb_data"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("source")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pb_data"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# optional if you want to change the PocketBase version")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token table class-name"}},[t._v("build.args")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("PB_VERSION")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.15.2"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token table class-name"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("http_checks")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("internal_port")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("processes")]),t._v("     "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"app"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("protocol")]),t._v("      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tcp"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("script_checks")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token table class-name"}},[t._v("services.concurrency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("hard_limit")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("soft_limit")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("type")]),t._v("       "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"connections"')]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token table class-name"}},[t._v("services.ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("force_https")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("handlers")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("port")]),t._v("        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token table class-name"}},[t._v("services.ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("handlers")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tls"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("port")]),t._v("     "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token table class-name"}},[t._v("services.tcp_checks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("grace_period")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1s"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("interval")]),t._v("      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"15s"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("restart_limit")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key property"}},[t._v("timeout")]),t._v("       "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2s"')]),t._v("\n")])])]),s("h3",{attrs:{id:"_5-deploy"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-deploy"}},[t._v("#")]),t._v(" 5. Deploy")]),t._v(" "),s("p",[t._v("Run "),s("code",[t._v("flyctl deploy")]),t._v(" and that's it!")]),t._v(" "),s("p",[t._v("To access your PocketBase dashboard navigate to "),s("code",[t._v("https://YOUR_APP_NAME.fly.dev/_/")]),t._v(".")]),t._v(" "),s("p",[t._v("To deploy new configuration/image changes, just run "),s("code",[t._v("flyctl deploy")]),t._v(" again.")]),t._v(" "),s("h3",{attrs:{id:"backup-and-downloading-a-copy-of-your-pb-data"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#backup-and-downloading-a-copy-of-your-pb-data"}},[t._v("#")]),t._v(" Backup and downloading a copy of your "),s("code",[t._v("pb_data")])]),t._v(" "),s("p",[t._v("Fly.io will even create a daily snapshot automatically for your volume (it will be kept for 5 days) - "),s("a",{attrs:{href:"https://fly.io/docs/reference/volumes/#snapshots-and-restores",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://fly.io/docs/reference/volumes/#snapshots-and-restores"),s("OutboundLink")],1),t._v(".")]),t._v(" "),s("p",[t._v("To download a copy of your remote "),s("code",[t._v("pb_data")]),t._v(" directory to your local machine, you could run the following commands in 2 separate terminals:")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# this will register a ssh key with your local agent (if you haven't already)")]),t._v("\nflyctl "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ssh")]),t._v(" issue "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--agent")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# proxies connections to a fly VM through a Wireguard tunnel")]),t._v("\nflyctl proxy "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10022")]),t._v(":22\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# run in a separate terminal to copy the pb_data directory")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("scp")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-r")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-P")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10022")]),t._v(" root@localhost:/pb/pb_data  /your/local/pb_data\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);